<!-- Upcoming Events Section -->
<section id="events" class="mt-16 p-8 text-center">
    <h2 class="text-3xl font-bold">Upcoming Events</h2>
    <div id="event-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-6">
        <!-- Events will be dynamically inserted here -->
    </div>
</section>

<script>
    async function loadEvents() {
        try {
            const response = await fetch("http://localhost:3000/events"); // Fetch from backend
            const events = await response.json();
            const eventList = document.getElementById("event-list");
            eventList.innerHTML = ""; // Clear existing events

            events.forEach(event => {
                const eventDate = new Date(event.date).getTime();
                const now = new Date().getTime();
                const timeLeft = eventDate - now;

                let status = "Upcoming"; 
                if (timeLeft <= 0) status = "Ongoing";

                const countdownId = `countdown-${event.id}`;

                const eventCard = `
                    <div class="bg-gray-800 p-6 rounded-lg shadow-lg hover:scale-105 transition-transform">
                        <img src="${event.image}" alt="${event.name}" class="w-full h-40 object-cover rounded-lg">
                        <h3 class="text-xl font-semibold text-white mt-4">${event.name}</h3>
                        <p class="text-gray-400">${status} | Date: ${event.date}</p>
                        <p id="${countdownId}" class="text-red-400 font-bold"></p>
                        <button onclick="redirectToEvent('${event.id}')" class="mt-4 px-6 py-2 bg-yellow-500 hover:bg-yellow-600 rounded-full font-bold">View Details & Register</button>
                    </div>
                `;
                eventList.innerHTML += eventCard;

                if (status === "Upcoming") startCountdown(eventDate, countdownId);
            });
        } catch (error) {
            console.error("Error loading events:", error);
        }
    }

    function startCountdown(eventDate, countdownId) {
        setInterval(() => {
            const now = new Date().getTime();
            const timeLeft = eventDate - now;

            if (timeLeft <= 0) {
                document.getElementById(countdownId).innerHTML = "Event is Live!";
                return;
            }

            const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

            document.getElementById(countdownId).innerHTML = `${days}d ${hours}h ${minutes}m ${seconds}s`;
        }, 1000);
    }

    function redirectToEvent(eventId) {
        window.location.href = `/event-details.html?id=${eventId}`;
    }

    document.addEventListener("DOMContentLoaded", loadEvents);
</script>
